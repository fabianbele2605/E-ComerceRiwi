create database ecommerce;

create table if not exists cities (
    id_city serial primary key,
    name varchar(100) not null unique,
    is_active boolean default true,

    created_at timestamp with time zone default current_timestamp,
    updated_at timestamp with time zone default current_timestamp
);

create table if not exists departaments (
    id_departament serial primary key,
    name varchar(100) not null unique,
    is_active boolean default true,

    created_at timestamp with time zone default current_timestamp,
    updated_at timestamp with time zone default current_timestamp
);

create table if not exists countries (
    id_country serial primary key,
    name varchar(100) not null unique,
    is_active boolean default true,

    created_at timestamp with time zone default current_timestamp,
    updated_at timestamp with time zone default current_timestamp
);

create table if not exists roles (
    id_role serial primary key,
    name varchar(100) not null unique,
    is_active boolean default true,

    created_at timestamp with time zone default current_timestamp,
    updated_at timestamp with time zone default current_timestamp
);

create table if not exists payment_methods (
    id_payment_method serial primary key,
    name varchar(100) not null unique,
    is_active boolean default true,
    
    created_at timestamp with time zone default current_timestamp,
    updated_at timestamp with time zone default current_timestamp
);

create table if not exists banks (
    id_bank serial primary key,
    name varchar(100) not null unique,
    is_active boolean default true,
    
    created_at timestamp with time zone default current_timestamp,
    updated_at timestamp with time zone default current_timestamp
);

create table if not exists categories (
    id_category serial primary key,
    name varchar(100) not null unique,
    is_active boolean default true,
    
    created_at timestamp with time zone default current_timestamp,
    updated_at timestamp with time zone default current_timestamp
);

create table if not exists order_status (
    id_order_status serial primary key,
    name varchar(100) not null unique,
    is_active boolean default true,
    
    created_at timestamp with time zone default current_timestamp,
    updated_at timestamp with time zone default current_timestamp
);

create table if not exists genders (
    id_gender serial primary key,
    name varchar(100) not null unique,
    is_active boolean default true,
    
    created_at timestamp with time zone default current_timestamp,
    updated_at timestamp with time zone default current_timestamp
);

create table if not exists accesses (
    id_access serial primary key,
    role_id int not null,
    username varchar(50) not null unique,
    password varchar(255) not null,
    is_active boolean default true,
    
    created_at timestamp with time zone default current_timestamp,
    updated_at timestamp with time zone default current_timestamp,

    foreign key (role_id) references roles(id_role)
);

create table if not exists users (
    id_user serial primary key,
    access_id int, 
    gender_id int,
    full_name varchar(100) not null,
    email varchar(100) not null unique,
    birth_date date,
    phone varchar(20),
    is_active boolean default true,
    
    created_at timestamp with time zone default current_timestamp,
    updated_at timestamp with time zone default current_timestamp,

    foreign key (access_id) references accesses(id_access),
    foreign key (gender_id) references genders(id_gender)
);

create table if not exists addresses (
    id_address serial primary key,
    user_id int not null,
    city_id int not null,
    departament_id int not null,
    country_id int not null,
    street varchar(100) not null,
    number varchar(20) not null,
    postal_code varchar(20),
    is_active boolean default true,
    
    created_at timestamp with time zone default current_timestamp,
    updated_at timestamp with time zone default current_timestamp,

    foreign key (user_id) references users(id_user),
    foreign key (city_id) references cities(id_city),
    foreign key (departament_id) references departaments(id_departament),
    foreign key (country_id) references countries(id_country)
);

create table if not exists products (
    id_product serial primary key,
    category_id int not null,
    name varchar(100) not null,
    description text,
    price decimal(12,2) not null,
    stock int default 0,
    is_active boolean default true,
    
    created_at timestamp with time zone default current_timestamp,
    updated_at timestamp with time zone default current_timestamp,

    foreign key (category_id) references categories(id_category)
);

create table if not exists orders (
    id_order serial primary key,
    customer_id int not null,
    bank_id int,
    order_status_id int not null,
    total decimal(12,2) not null,
    is_active boolean default true,
    
    created_at timestamp with time zone default current_timestamp,
    updated_at timestamp with time zone default current_timestamp,

    foreign key (customer_id) references accesses(id_access),
    foreign key (bank_id) references banks(id_bank),
    foreign key (order_status_id) references order_status(id_order_status)
);

create table if not exists order_payments (
    id_order_payment serial primary key,
    order_id int not null,
    payment_method_id int not null,
    amount decimal(12,2) not null,
    payment_date timestamp with time zone default current_timestamp,
    is_active boolean default true,
    
    created_at timestamp with time zone default current_timestamp,
    updated_at timestamp with time zone default current_timestamp,

    foreign key (order_id) references orders(id_order),
    foreign key (payment_method_id) references payment_methods(id_payment_method)
);

create table if not exists order_items (
    id_order_item serial primary key,
    order_id int not null,
    product_id int not null,
    quantity int not null,
    price decimal(12,2) not null,
    subtotal decimal(12,2) not null,
    is_active boolean default true,
    
    created_at timestamp with time zone default current_timestamp,
    updated_at timestamp with time zone default current_timestamp,

    foreign key (order_id) references orders(id_order),
    foreign key (product_id) references products(id_product)
);
