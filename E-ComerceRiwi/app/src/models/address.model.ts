// app/src/models/address.model.ts

/**
 * address model
 * -----------------
 * This file defines the Sequelize `Address` model, which represents the `addresses` table in the database.
 *
 * It contains:
 * - Model attributes (`AddressAttributes`).
 * - Required attributes for creation (`AddressCreationAttributes`).
 * - Definition of the model with its columns and constraints.
 *
 * This model is used by services and controllers to perform CRUD operations.
 */
import { DataTypes, Model, Optional } from "sequelize";
import sequelize from "../config/database";

/**
 * Attributes for `Address`.
 */
export interface AddressAttributes {
    id_address: number;
    user_id: number;
    city_id: number;
    department_id: number;
    country_id: number;
    street: string;
    number: string;
    postal_code: string;
    is_active: boolean;
    createdAt?: Date;
    updatedAt?: Date;
}

/**
 * Attributes used for creating a new address.
 * `Optional` is used to indicate that `id` is not required at the time
 * of creation, as it is automatically generated by the database.
 */
export interface AddressCreationAttributes extends Optional<AddressAttributes, "id_address"> { }

/**
 * Class that represents the `Address` model in Sequelize.
 *
 * Implements the attributes defined in `AddressAttributes` and `AddressCreationAttributes`.
 */
class Address extends Model<AddressAttributes, AddressCreationAttributes> implements AddressAttributes {

    public id_address!: number;
    public user_id!: number;
    public city_id!: number;
    public department_id!: number;
    public country_id!: number;
    public street!: string;
    public number!: string;
    public postal_code!: string;
    public is_active!: boolean;
    public createdAt!: Date;
    public updatedAt!: Date;
}

/**
 * Initialization of the `Address` model with Sequelize configuration.
 *
 * - `id_address`: Auto-incrementing integer, primary key.
 * - `user_id`: Foreign key referencing the user associated with the address.
 * - `city_id`: Foreign key referencing the city of the address.
 * - `departament_id`: Foreign key referencing the department of the address.
 * - `country_id`: Foreign key referencing the country of the address.
 * - `street`: String representing the street name.
 * - `number`: String representing the street number.
 * - `postal_code`: String representing the postal code.
 * - `is_active`: Boolean to determine if the address is active or inactive.
 */
Address.init(
    {
        id_address: {
            type: DataTypes.INTEGER,
            autoIncrement: true,
            primaryKey: true,
        },
        user_id: {
            type: DataTypes.INTEGER,
            allowNull: false,
            references: {
                model: "users", 
                key: "id_user"
            }
        },
        city_id: {
            type: DataTypes.INTEGER,
            allowNull: false,
            references: {
                model: "cities", 
                key: "id_city"
            }
        },
        department_id: {
            type: DataTypes.INTEGER,
            allowNull: false,
            references: {
                model: "departments", 
                key: "id_department"
            }
        },
        country_id: {
            type: DataTypes.INTEGER,
            allowNull: false,
            references: {
                model: "countries", 
                key: "id_country"
            }
        },
        street: {
            type: DataTypes.STRING(100),
            allowNull: false,
        },
        number: {
            type: DataTypes.STRING(20),
            allowNull: false,
        },
        postal_code: {
            type: DataTypes.STRING(20),
            allowNull: true,
        },
        is_active: {
            type: DataTypes.BOOLEAN,
            allowNull: false,
            defaultValue: true,
        }
    },
    {
        sequelize,
        modelName: "Address",   
        tableName: "addresses",  
        timestamps: true,      
        createdAt: "created_at",
        updatedAt: "updated_at"
    }
);

export default Address;